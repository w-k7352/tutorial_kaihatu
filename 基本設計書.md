# 基本設計書 v1.0 — 1画面「ToDo＋期限管理」ミニWebアプリ

## 1. 概要

本ドキュメントは、「要件定義書 v1.0」に基づき、ToDo管理Webアプリケーションの基本設計を定義する。
本アプリは、個人のタスク管理と生産性向上を目的とした、単一画面で動作するフロントエンド完結のアプリケーションである。

## 2. システム構成

- **アーキテクチャ**: SPA (Single Page Application)
- **使用技術**:
    - HTML5
    - CSS3
    - JavaScript (ES6+, Vanilla JS)
- **実行環境**: モダンブラウザ (Chrome, Edge, Firefox, Safari の現行版)
- **データストア**: ブラウザの `localStorage` を使用し、クライアントサイドでデータを永続化する。

## 3. 画面設計

単一のHTMLファイル（`index.html`）で以下の3エリア構成とする。レスポンシブデザインを採用し、PC・モバイル双方の利用に対応する。

```
+------------------------------------------------------+
| ヘッダーエリア                                       |
| - アプリタイトル                                     |
| - タスク件数カウンタ (未着手/進行中/完了)            |
+------------------------------------------------------+
| 新規タスク登録フォームエリア                         |
| - 入力欄: タイトル(必須), 期限, タグ(カンマ区切り)   |
| - ボタン: 追加                                       |
+------------------------------------------------------+
| フィルタ & ソートエリア                              |
| - フィルタ: キーワード, タグ, 期限範囲, ステータス   |
| - ソート: 期限(昇順), 作成日(昇順/降順), タイトル(昇順)|
| - 操作: フィルタクリアボタン                         |
+------------------------------------------------------+
| タスク一覧表示エリア (テーブル形式)                  |
|                                                      |
| [ ] | タイトル      | 期限(バッジ) | タグ     | ステータス | 操作 |
|-----|---------------|--------------|----------|------------|------|
| (✓) | タスクA(取消線)| 本日         | tagA     | 完了       | 編集/削除 |
| ( ) | タスクB       | 2025-09-08   | tagB     | 進行中     | 編集/削除 |
| ( ) | タスクC       | (期限切れ)   | tagA,tagC| 未着手     | 編集/削除 |
| ... |               |              |          |            |      |
+------------------------------------------------------+
| フッターエリア                                       |
| - CSVエクスポートボタン                              |
+------------------------------------------------------+
```

- **ヘッダー**: `FR-09` に基づき、各ステータスのタスク件数を表示する。
- **新規登録フォーム**: `FR-01`, `FR-10` に基づき、タスクの入力と登録を行う。
- **フィルタ & ソート**: `FR-06`, `FR-07`, `FR-13` に基づき、表示するタスクの絞り込みと並び替えを行う。
- **タスク一覧**: `FR-05` に基づき、タスクを表形式で表示する。`FR-03`, `FR-08`, `UI-05` に従い、完了状態のトグル、期限の視覚化、ステータスの色分けを行う。
- **フッター**: `FR-11` に基づき、CSVエクスポート機能を提供する。

## 4. 機能設計

### 4.1. タスク管理機能 (CRUD)

- **登録 (Create)**:
    - `UC-01`: 新規登録フォームから入力された値でタスクオブジェクトを生成。`id`はUUIDで採番、`status`は`todo`で初期化。
    - バリデーション: タイトルが空の場合はエラーメッセージを表示し、登録を中断する (`AC-06`)。
- **表示 (Read)**:
    - `UC-05, UC-06`: `localStorage`から全タスクを取得後、指定されたフィルタ条件とソート順に従って表示を動的に更新する。
- **更新 (Update)**:
    - `UC-02`: 「編集」ボタンクリックで行内編集モードに切り替えるか、モーダルダイアログを表示する (`FR-12`)。変更を保存すると`updated_at`が更新される。
    - `UC-03`: 完了チェックボックスのクリックで、`status`を`done` ⇔ `todo`に切り替える (`FR-03`)。
- **削除 (Delete)**:
    - `UC-04`: 「削除」ボタンクリックで確認ダイアログを表示後、承認されると`localStorage`から該当タスクを削除する (`FR-04`)。

### 4.2. データ永続化

- `DR-01`: 全てのタスクデータは、単一のキー（例: `todo_tasks_v1`）で`localStorage`にJSON文字列として保存する。
- アプリケーションの起動時に`localStorage`からデータを読み込み、終了時やデータ変更時に書き戻す。

### 4.3. CSVエクスポート機能

- `UC-07`: 「CSVエクスポート」ボタンをクリックすると、現在`localStorage`に保存されている全てのタスクデータをCSV形式で生成し、ダウンロードさせる (`FR-11`)。
- 文字コードは`UTF-8`、日付形式は`YYYY-MM-DD`とする。

## 5. データ設計

`localStorage`に保存するデータスキーマは以下の通り。

- **キー**: `todo_tasks_v1`
- **値**: `Task`オブジェクトの配列をJSONシリアライズした文字列。

### 5.1. Task オブジェクト スキーマ (`DR-02`)

| フィールド名 | 型         | 説明                                   | 必須 | 例                                   |
|--------------|------------|----------------------------------------|------|--------------------------------------|
| `id`         | `string`   | 一意な識別子 (UUID v4)                 | ✓    | `"123e4567-e89b-12d3-a456-426614174000"` |
| `title`      | `string`   | タスクのタイトル (1-200文字)           | ✓    | `"基本設計書を作成する"`             |
| `due`        | `string`   | 期限 (YYYY-MM-DD形式)。未設定時は`null`|      | `"2025-09-07"`                       |
| `tags`       | `string[]` | タグの配列。0件以上                    | ✓    | `["設計", "資料"]`                   |
| `status`     | `string`   | `todo`, `doing`, `done` のいずれか     | ✓    | `"doing"`                            |
| `created_at` | `string`   | 作成日時 (ISO 8601)                    | ✓    | `"2025-09-07T10:00:00.000Z"`         |
| `updated_at` | `string`   | 更新日時 (ISO 8601)                    | ✓    | `"2025-09-07T11:00:00.000Z"`         |

### 5.2. CSVフォーマット (`DR-04`)

- ヘッダー行を含む。
- カラム順: `id,title,due,tags,status,created_at,updated_at`
- `tags`は配列をカンマ区切りにした文字列として表現する（例: `"設計,資料"`）。

## 6. モジュール設計

コードの保守性と関心の分離 (`NFR-05`) のため、以下のモジュール（ファイル）に分割する。

- **`index.html`**: アプリケーションの骨格となるHTML。各エリアのコンテナを配置。
- **`style.css`**: UIのスタイリング、レスポンシブデザイン、視覚的フィードバック（色分け、打消し線等）を定義。
- **`app.js` (メインロジック)**:
    - アプリケーション全体の状態管理（タスク配列）。
    - 各モジュールの初期化と連携。
    - UIイベント（クリック、入力等）を監視し、対応する処理を呼び出すイベントハンドリング。
- **`view.js` (UI/DOM操作)**:
    - タスク一覧の描画、更新、フィルタリング/ソート結果の反映。
    - フォーム、カウンタ、フィードバックメッセージ等のDOM操作全般を責務とする。
- **`storage.js` (リポジトリ層)**:
    - `localStorage`に対するCRUD（読み込み、書き込み、更新、削除）操作を抽象化する。
    - 他のモジュールは本モジュール経由でのみデータ永続化を行う。
- **`utils.js` (共通関数)**:
    - UUID生成、日付フォーマット、CSV生成など、プロジェクト全体で利用されるヘルパー関数を提供する。

## 7. 非機能要件への対応

- **パフォーマンス (`NFR-01`)**:
    - 500件のタスクでも軽快に動作するよう、DOM操作は最小限に留める。
    - イベントリスナーはイベントデリゲーションを活用し、登録数を削減する。
- **保守性 (`NFR-05`)**:
    - 上記モジュール設計の通り、`storage.js`にデータアクセス層を分離することで、将来的なバックエンドへの移行を容易にする。
- **アクセシビリティ (`NFR-06`, `UI-02`)**:
    - 適切なHTMLセマンティクスを用いる。
    - 全ての操作可能な要素に`tabindex`を設定し、キーボードフォーカスが当たるようにする。
    - `aria-label`や`role`属性を付与し、スクリーンリーダーの読み上げに対応する。
    - フォーカス状態を視覚的に明示する。
